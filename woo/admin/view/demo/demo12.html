{extend name="$extend_global"/}
{block name="content"}
<div class="loading">
    <div class="loadbox"><img src="{$root}static/charts1/picture/loading.gif"> 页面加载中...</div>
</div>
<div class="head">
    <h1>“电销”业绩大数据</h1>
    <div class="weather"><span>{:date('Y年m月d日')} {$week[date('w')]}</span></div>
</div>
<div class="mainbox">
    <ul class="clearfix">
        <li>
            <div class="boxall" style="height: 2.4rem">
                <div class="alltitle">数据展示</div>
                <div class="sycm">
                    <ul class="clearfix">
                        {foreach $charts.charts_1 as $index => $item}
                        {if $index + 1 <= 6}
                        <li><h2>{$item.rows}</h2><span>{$item.title}</span></li>
                        {if ($index + 1) % 3 == 0 && count($charts.charts_1) > 3}
                    </ul>
                    <div style="border-bottom: 1px solid rgba(255,255,255,.1)"></div>
                    <ul class="clearfix">
                        {/if}
                        {/if}
                        {/foreach}
                    </ul>
                </div>
                <div class="boxfoot"></div>
            </div>
            <div class="boxall" style="height: 2.42rem">
                <div class="alltitle">数据占比</div>
                <div class="boxfoot"></div>
                <div id="mycharts1">
                    <div class="charts-list">
                        {foreach $charts.charts_1 as $item}
                        <div class="charts-item"></div>
                        {/foreach}
                    </div>
                </div>
            </div>
            <div class="boxall" style="height: 2.6rem">
                <div class="alltitle">数据反馈</div>
                <div id="mycharts2" style="height: 2.2rem; width: 100%;"></div>
                <div class="boxfoot"></div>
            </div>
        </li>
        <li>
            <div class="bar">
                <div class="barbox">
                    <ul class="clearfix">
                        <li class="pulll_left counter">{$charts.total}</li>
                        <li class="pulll_left counter">{$charts.break_total}</li>
                    </ul>
                </div>
                <div class="barbox2">
                    <ul class="clearfix">
                        <li class="pulll_left">订单总数</li>
                        <li class="pulll_left">支付总数</li>
                    </ul>
                </div>
            </div>
            <div class="map">
                <div class="map1"><img src="{$root}static/charts1/picture/lbx.png"></div>
                <div class="map2"><img src="{$root}static/charts1/picture/jt.png"></div>
                <div class="map3"><img src="{$root}static/charts1/picture/map.png"></div>
            </div>
        </li>
        <li>
            <div class="boxall" >
                <div class="alltitle">最新注册</div>
                <div class="clearfix">
                    <div id="mycharts3">
                        <div class="charts-list">
                            {foreach  $charts.charts_2 as $item}
                            <div class="charts-item"></div>
                            {/foreach}
                        </div>
                    </div>
                </div>
                <div class="addnew">
                    <div class="adduser">
                        <ul class="clearfix relation">
                            {foreach $charts.charts_2 as $item}
                            <li class="clearfix"><a href="{:url('plan/result', ['id' => $item.id])}" target="_blank"><span class="pulll_left">{$item.title}</span>
                                <span class="pulll_right">{$item.rows}</span></a></li>
                            {/foreach}
                        </ul>
                    </div>
                </div>
                <div class="boxfoot"></div>
            </div>
            <div class="boxall" style="height: 3.39rem">
                <div class="alltitle">实时销售记录</div>
                <div class="wrap" id="slide1">
                    <ul class="relation">
                        {foreach $charts.break_list as $item}
                        <li>
                            <p>{$item}</p>
                        </li>
                        {/foreach}
                    </ul>
                </div>
                <div class="boxfoot"></div>
            </div>
        </li>
    </ul>
</div>
{/block}
{block name="footer"}{/block}
{block name="script"}
<script>
    var charts1Options = {:json_encode($charts.charts_1)};
    var charts3Options = {:json_encode($charts.charts_2)};

    $(window).on('load',function () {
        $(".loading").fadeOut(function () {
            $(".counter").countTo({
                lastSymbol:"",
                from: 0,
                speed: 500,
                refreshInterval: 10,
                beforeSize:0,
                decimals: 0
            });
        })
    })
    var w = $(window).width()
    $("html").css({ fontSize: w / 20 })


    var slide1Len = $('#slide1 li').length;
    if (slide1Len > 5) {
        setInterval(function () {
            $('#slide1 ul').animate({top : '-.52rem'} , 800, function() {
                $('#slide1 ul').css('top', 0);
                $('#slide1 ul li:first').insertAfter('#slide1 ul li:last');
            })
        }, 2400)
    }


    // 图1
    var mycharts1Len = $('#mycharts1 .charts-item').length;
    $('#mycharts1 .charts-list').width(mycharts1Len * 33.33 + '%');

    if (mycharts1Len > 3) {
        setInterval(function () {
            $('#mycharts1 .charts-list').animate({ 'left': '-33.33%' }, 800, function () {
                $('#mycharts1 .charts-list').css('left', 0);
                $('#mycharts1 .charts-list .charts-item:first').insertAfter('#mycharts1 .charts-list .charts-item:last');
            });
        }, 4000)
    }

    var mycharts1List = [];
    $('#mycharts1 .charts-item').each(function () {
        var index = $(this).index();
        mycharts1List[index] = echarts.init(this);
        var data = charts1Options[index];
        var option = {
            title: {
                text: data.title,
                bottom: 10,
                left: 'center',
                textStyle: {
                    fontWeight: 'normal',
                    color: 'rgba(255,255,255,0.6)',
                    fontSize: 13
                }
            },
            series: [{
                type: 'pie',
                radius: ['70%', '80%'],
                color: data.color,
                label: {
                    position:'center',
                },
                data: [{
                    value: data.breaks,
                    name: '发货数',
                    label: {
                        normal: {
                            formatter: data.breaks.toString(),
                            textStyle: {
                                fontSize: 18,
                                color: '#fff',
                            }
                        }
                    }
                }, {
                    value: data.rows - data.breaks,
                    name: '销售数',
                    label: {
                        normal: {
                            formatter: function (params) {
                                if (!data.rows) {
                                    return '\n\n\n占比0%'
                                }
                                return '\n\n\n占比' + Math.round(data.breaks / data.rows * 100) + '%'
                            },
                            textStyle: {
                                color: '#aaa',
                                fontSize: 12
                            }
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: 'rgba(255,255,255,.2)'
                        },
                        emphasis: {
                            color: '#fff'
                        }
                    },
                }]
            }]
        };
        mycharts1List[index].setOption(option);
    })

    // 图3
    var mycharts3Len = $('#mycharts3 .charts-item').length;
    $('#mycharts3 .charts-list').width(mycharts3Len * 33.33 + '%');

    if (mycharts3Len > 3) {
        setInterval(function () {
            $('#mycharts3 .charts-list').animate({ 'left': '-33.33%' }, 800, function () {
                $('#mycharts3 .charts-list').css('left', 0);
                $('#mycharts3 .charts-list .charts-item:first').insertAfter('#mycharts3 .charts-list .charts-item:last');
            });
            $('.adduser ul').animate({top : '-.5rem'} , 800, function() {
                $('.adduser ul').css('top', 0);
                $('.adduser ul li:first').insertAfter('.adduser ul li:last');
            })
        }, 4300)
    }

    var mycharts3List = [];
    $('#mycharts3 .charts-item').each(function () {
        var index = $(this).index();
        mycharts3List[index] = echarts.init(this);
        var data = charts3Options[index];
        var option = {
            title: {
                text: data.sub_title,
                bottom: 10,
                left: 'center',
                textStyle: {
                    fontWeight: 'normal',
                    color: 'rgba(255,255,255,0.6)',
                    fontSize: 13
                }
            },
            series: [{
                type: 'pie',
                radius: ['70%', '80%'],
                color: data.color,
                label: {
                    normal: {
                        position: 'center'
                    }
                },
                data: [{
                    value: data.breaks,
                    name: '注册数',
                    label: {
                        normal: {
                            formatter: data.breaks + '',
                            textStyle: {
                                fontSize: 18,
                                color: '#fff',
                            }
                        }
                    }
                }, {
                    value: data.breaks > 0 ? data.rows - data.breaks : 100,
                    name: '审核数',
                    label: {
                        normal: {
                            formatter: function (params) {
                                if (!data.rows) {
                                    return '\n\n\n占比0%'
                                }
                                return '\n\n\n占比' + Math.round(data.breaks / data.rows * 100) + '%'
                            },
                            textStyle: {
                                color: '#aaa',
                                fontSize: 12
                            }
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: 'rgba(255,255,255,.2)'
                        },
                        emphasis: {
                            color: '#fff'
                        }
                    },
                }]
            }]
        };
        mycharts3List[index].setOption(option);
    })

    // 图2
    var mychart2 = echarts.init(document.getElementById('mycharts2'));
    (function () {
        var plantCap = [];
        var datalist = [];
        var plantCapOffset = [
            [56, 48],
            [30, 70],
            [0, 43],
            [93, 30],
            [26, 19],
            [75, 75]
        ]
        for (var i in charts1Options) {
            if (i > 5) {
                break;
            }
            plantCap.push({
                name: charts1Options[i].title,
                value: charts1Options[i].breaks
            });
            var size = 50;
            if (charts1Options[i]. breaks > 0) {
                size += (charts1Options[i]. breaks / charts1Options[i].rows) * 100 ;
            }
            datalist.push({
                offset: plantCapOffset[i],
                symbolSize:  size,
                color: 'rgba(73,188,247,.14)'
            })
        }

        var datas = [];
        for (var i = 0; i < plantCap.length; i++) {
            var item = plantCap[i];
            var itemToStyle = datalist[i];
            datas.push({
                name: item.value + '\n' + item.name,
                value: itemToStyle.offset,
                symbolSize: itemToStyle.symbolSize,
                label: {
                    normal: {
                        textStyle: {
                            fontSize: 12
                        }
                    }
                },
                itemStyle: {
                    normal: {
                        color: itemToStyle.color,
                        opacity: itemToStyle.opacity
                    }
                },
            })
        }
        var option = {
            grid: {
                show: false,
                top: 10,
                bottom: 10
            },

            xAxis: [{
                gridIndex: 0,
                type: 'value',
                show: false,
                min: 0,
                max: 100,
                nameLocation: 'middle',
                nameGap: 5
            }],

            yAxis: [{
                gridIndex: 0,
                min: 0,
                show: false,
                max: 100,
                nameLocation: 'middle',
                nameGap: 30
            }],
            series: [{
                type: 'scatter',
                symbol: 'circle',
                symbolSize: 120,
                label: {
                    normal: {
                        show: true,
                        formatter: '{b}',
                        color: 'rgba(255,255,255,0.5)',
                        textStyle: {
                            fontSize: '30'
                        }
                    },
                },
                itemStyle: {
                    normal: {
                        color: '#F30'
                    }
                },
                data: datas
            }]

        };
        mychart2.setOption(option);
    })();

    $(window).resize(function () {
        w = $(window).width();
        $("html").css({ fontSize: w / 20 });
        for (var i = 0; i <= mycharts1List.length - 1; i++) {
            mycharts1List[i].resize();
        }
        for (var i = 0; i <= mycharts3List.length - 1; i++) {
            mycharts3List[i].resize();
        }
        mychart2.resize();
    });
</script>
{/block}